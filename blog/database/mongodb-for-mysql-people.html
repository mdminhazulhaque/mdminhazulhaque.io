<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="MongoDB for MySQL People" />
        <meta name="author" content="Md. Minhazul Haque">
        <title>
        MongoDB for MySQL People | 
        
        Minhaz Blog
        </title>
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Bengali&family=Ubuntu&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/styles/default.min.css">
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9642838276352812" crossorigin="anonymous"></script>
        <style>
        body {
            font-family: 'Ubuntu', 'Noto Serif Bengali', serif !important;
        }
        </style>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="/blog">
                    Minhaz
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        
                        <li class="nav-item"><a class="nav-link" href="/blog">Blog</a>
                        </li>
                        
                        <li class="nav-item"><a class="nav-link" href="https://github.com/mdminhazulhaque">Github</a>
                        </li>
                        
                        <li class="nav-item"><a class="nav-link" href="https://www.linkedin.com/in/mdminhazulhaque/">LinkedIn</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </nav>
        <div class="container mt-4">
            <div class="row">
                <div class="col-lg-9">
                    

<article>
    <header class="mb-4">
        <h1 class="fw-bolder mb-1">MongoDB for MySQL People</h1>
        <div class="text-muted fst-italic mb-2">Posted on 30 Jul, 2020 in database</div>
    </header>
    <section class="mb-5">

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-9642838276352812"
     data-ad-slot="8038474176"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<br>

        <p>I am a MySQL guy. I can query MySQL, BigQuery or SQL-like databases for my day to day business. Last week, I faced a challenge where I needed to extract some information from a production MongoDB server that involves aggregation. I had no idea how MongoDB works or how to run CRUD operation on such database. So obviously, I spent my whole weekend in learning MongoDB. In this post I am going to share the MongoDB queries I learnt, and the equivalent MySQL queries as well.</p>
<blockquote>
<p>I used MongoDB v3.6, for both daemon and cli, so some functions may not work with your current setup</p>
</blockquote>
<h2>Populate Data and Load into MongoDB</h2>
<p>I used the following piece of code to scrap my Github profile information into a single JSON file.</p>
<pre><code class="language-python">import requests
import json

username = 'mdminhazulhaque'
repos = []
page = 1

while True:
    params = (
        ('page', page),
        ('type', 'owner'),
        ('per_page', 100)
    )
    response = requests.get('https://api.github.com/users/{username}/repos'\
        .format(username=username), params=params)
    for single in response.json():
        repos.append({
            &quot;name&quot;: single.get('name', None),
            &quot;description&quot;: single.get('description', None),
            &quot;created_at&quot;: single.get('created_at', None),
            &quot;language&quot;: single.get('language', None),
            &quot;stargazers_count&quot;: single.get('stargazers_count', None)
        })
    if len(response.json()) &lt; 100:
        break
    else:
        page += 1
with open(&quot;github.json&quot;, &quot;w&quot;) as fp:
    json.dump(repos, fp, indent=4)
</code></pre>
<p>Then I loaded the JSON data into MongoDB using <code>mongoimport</code>.</p>
<pre><code class="language-bash">mongoimport --db local --collection repos --drop --jsonArray --file github.json 
</code></pre>
<p>One record from the <code>repo</code> collection looks like the following.</p>
<pre><code class="language-bash">$ mongo 127.0.0.1/local
&gt; db.repos.findOne()
{
        &quot;_id&quot; : ObjectId(&quot;5f1cfca24662cbc419b65e29&quot;),
        &quot;name&quot; : &quot;a-pdf-reader&quot;,
        &quot;description&quot; : &quot;A poppler based pdf reader written in Qt4&quot;,
        &quot;created_at&quot; : &quot;2012-10-07T20:44:48Z&quot;,
        &quot;language&quot; : &quot;C++&quot;,
        &quot;stargazers_count&quot;: null
}
</code></pre>
<p>Let's start playing with MongoDB.</p>
<h2>SELECT</h2>
<h3>select * from repos</h3>
<pre><code class="language-bash">&gt; db.repos.find({})

{ &quot;_id&quot; : ObjectId(&quot;5f1cfca24662cbc419b65e2a&quot;), &quot;name&quot; : &quot;apt-sync&quot;, &quot;created_at&quot; : &quot;2017-11-19T04:57:23Z&quot;, &quot;language&quot; : &quot;Python&quot;, &quot;stargazers_count&quot; : 0 }
{ &quot;_id&quot; : ObjectId(&quot;5f1cfca24662cbc419b65e2b&quot;), &quot;name&quot; : &quot;aws-cli-cheatsheet&quot;, &quot;created_at&quot; : &quot;2020-02-27T16:38:21Z&quot;, &quot;language&quot; : null, &quot;stargazers_count&quot; : 52 }
{ &quot;_id&quot; : ObjectId(&quot;5f1cfca24662cbc419b65e2c&quot;), &quot;name&quot; : &quot;banglalion-wimax-mac&quot;, &quot;created_at&quot; : &quot;2015-02-25T19:15:48Z&quot;, &quot;language&quot; : &quot;HTML&quot;, &quot;stargazers_count&quot; : 0 }
{ &quot;_id&quot; : ObjectId(&quot;5f1cfca24662cbc419b65e2d&quot;), &quot;name&quot; : &quot;annoying-bn-text&quot;, &quot;created_at&quot; : &quot;2019-06-05T17:25:05Z&quot;, &quot;language&quot; : &quot;HTML&quot;, &quot;stargazers_count&quot; : 1 }
{ &quot;_id&quot; : ObjectId(&quot;5f1cfca24662cbc419b65e2e&quot;), &quot;name&quot; : &quot;banglalionwimaxapi&quot;, &quot;created_at&quot; : &quot;2018-10-16T13:03:53Z&quot;, &quot;language&quot; : &quot;Python&quot;, &quot;stargazers_count&quot; : 0 }
{ &quot;_id&quot; : ObjectId(&quot;5f1cfca24662cbc419b65e2f&quot;), &quot;name&quot; : &quot;bcm-wimax-dkms&quot;, &quot;created_at&quot; : &quot;2017-05-20T18:22:07Z&quot;, &quot;language&quot; : &quot;C&quot;, &quot;stargazers_count&quot; : 0 }
{ &quot;_id&quot; : ObjectId(&quot;5f1cfca24662cbc419b65e30&quot;), &quot;name&quot; : &quot;bd-mrp-api&quot;, &quot;created_at&quot; : &quot;2018-12-31T20:26:48Z&quot;, &quot;language&quot; : &quot;Python&quot;, &quot;stargazers_count&quot; : 1 }
</code></pre>
<h3>select name, description from repos</h3>
<pre><code class="language-bash">&gt; db.repos.find({}, {_id:0, name:1, description:1})

{ &quot;name&quot; : &quot;a-pdf-reader&quot;, &quot;description&quot; : &quot;A poppler based pdf reader written in Qt4&quot; }
{ &quot;name&quot; : &quot;apt-sync&quot;, &quot;description&quot; : &quot;:gift: Sync APT installed package list across different machines&quot; }
{ &quot;name&quot; : &quot;aws-cli-cheatsheet&quot;, &quot;description&quot; : &quot;:cloud: AWS CLI + JQ = Make life easier&quot; }
{ &quot;name&quot; : &quot;banglalion-wimax-mac&quot;, &quot;description&quot; : &quot;:satellite: Banglalion WiMAX on Mac OS X&quot; }
{ &quot;name&quot; : &quot;annoying-bn-text&quot;, &quot;description&quot; : &quot;Piss of your friends with awkwardly written Bengali text&quot; }
</code></pre>
<h3>select name, description from repos limit 2</h3>
<pre><code class="language-bash">&gt; db.repos.aggregate([{$project:{_id:0, name:1, description:1}}, {$limit:5}])

{ &quot;name&quot; : &quot;a-pdf-reader&quot;, &quot;description&quot; : &quot;A poppler based pdf reader written in Qt4&quot; }
{ &quot;name&quot; : &quot;apt-sync&quot;, &quot;description&quot; : &quot;:gift: Sync APT installed package list across different machines&quot; }
</code></pre>
<h3>select name, description from repos order by name</h3>
<pre><code class="language-bash">&gt; db.repos.find({}, {_id:0, name:1, description:1}).sort({name:1})

{ &quot;name&quot; : &quot;Android-Javascript-Bridge&quot;, &quot;description&quot; : &quot;Android and Javascript two way communication&quot; }
{ &quot;name&quot; : &quot;Android-JavascriptInterface-Sample&quot;, &quot;description&quot; : &quot;Call Java (Android) methods from Webview using Javascript&quot; }
{ &quot;name&quot; : &quot;Bilai-PnP-Gui&quot;, &quot;description&quot; : &quot;:cat2: GUI for Bilai PnP Modems&quot; }
{ &quot;name&quot; : &quot;CPPad&quot;, &quot;description&quot; : &quot;Write and run C++ codes, instantly!&quot; }
{ &quot;name&quot; : &quot;CSE10Routine&quot;, &quot;description&quot; : &quot;Tabbed routine app&quot; }
</code></pre>
<h3>select name, stargazers_count from repos order by stargazers_count desc</h3>
<pre><code class="language-bash">&gt; db.repos.find({}, {_id:0, name:1, stargazers_count:1}).sort({stargazers_count:-1})

{ &quot;name&quot; : &quot;aws-cli-cheatsheet&quot;, &quot;stargazers_count&quot; : 52 }
{ &quot;name&quot; : &quot;probhat-osx&quot;, &quot;stargazers_count&quot; : 23 }
{ &quot;name&quot; : &quot;PyQt-BPNN&quot;, &quot;stargazers_count&quot; : 22 }
{ &quot;name&quot; : &quot;foreach&quot;, &quot;stargazers_count&quot; : 14 }
{ &quot;name&quot; : &quot;html-table-to-json&quot;, &quot;stargazers_count&quot; : 12 }
</code></pre>
<h3>select name, stargazers_count from repos where stargazers_count &gt; 20 order by stargazers_count</h3>
<pre><code class="language-bash">&gt; db.repos.find({ stargazers_count: { $gt: 20} }, {_id:0, name:1, stargazers_count:1}).sort({stargazers_count:-1})

{ &quot;name&quot; : &quot;aws-cli-cheatsheet&quot;, &quot;stargazers_count&quot; : 52 }
{ &quot;name&quot; : &quot;probhat-osx&quot;, &quot;stargazers_count&quot; : 23 }
{ &quot;name&quot; : &quot;PyQt-BPNN&quot;, &quot;stargazers_count&quot; : 22 }
</code></pre>
<h3>select name, stargazers_count from repos where language = "Python"</h3>
<pre><code class="language-bash">&gt; db.repos.find({ language: &quot;Python&quot; }, {_id:0, name:1, stargazers_count:1})

{ &quot;name&quot; : &quot;apt-sync&quot;, &quot;stargazers_count&quot; : 0 }
{ &quot;name&quot; : &quot;banglalionwimaxapi&quot;, &quot;stargazers_count&quot; : 0 }
{ &quot;name&quot; : &quot;bd-mrp-api&quot;, &quot;stargazers_count&quot; : 1 }
{ &quot;name&quot; : &quot;flightaware-cli&quot;, &quot;stargazers_count&quot; : 0 }
{ &quot;name&quot; : &quot;html-table-to-json&quot;, &quot;stargazers_count&quot; : 12 }
</code></pre>
<h4>select name, description from repos where description like "%cli%"</h4>
<pre><code class="language-bash">&gt; db.repos.find({ description: /cli/i }, {_id:0, name:1, description:1})

{ &quot;name&quot; : &quot;aws-cli-cheatsheet&quot;, &quot;description&quot; : &quot;:cloud: AWS CLI + JQ = Make life easier&quot; }
{ &quot;name&quot; : &quot;ClipMonitor&quot;, &quot;description&quot; : &quot;A tiny clip monitor app built with Qt5&quot; }
{ &quot;name&quot; : &quot;foreach&quot;, &quot;description&quot; : &quot;:repeat: Read lines from file/stdin and execute them as CLI argument&quot; }
{ &quot;name&quot; : &quot;kakitangan-cli&quot;, &quot;description&quot; : &quot;:briefcase: CLI for Kakitangan app, the online HR Software for Malaysian businesses&quot; }
{ &quot;name&quot; : &quot;librs232&quot;, &quot;description&quot; : &quot;:paperclip: RS232 Library in C&quot; }
</code></pre>
<h3>select language, count(*) as count, description from repos group by language order by count</h3>
<pre><code class="language-bash">&gt; db.repos.aggregate([{ $group: { _id: &quot;$language&quot;, count: { $sum: 1 } } },{ $sort: { count: -1 } }])

{ &quot;_id&quot; : &quot;C++&quot;, &quot;count&quot; : 61 }
{ &quot;_id&quot; : &quot;Python&quot;, &quot;count&quot; : 25 }
{ &quot;_id&quot; : &quot;HTML&quot;, &quot;count&quot; : 12 }
{ &quot;_id&quot; : &quot;Java&quot;, &quot;count&quot; : 12 }
{ &quot;_id&quot; : &quot;Shell&quot;, &quot;count&quot; : 10 }
</code></pre>
<h3>select language, sum(stargazers_count) as stars, description from repos group by language order by stars</h3>
<pre><code class="language-bash">&gt; db.repos.aggregate([{ $group: { _id: &quot;$language&quot;, stars: { $sum: &quot;$stargazers_count&quot; } } },{ $sort: { stars: -1 } }])

{ &quot;_id&quot; : &quot;C++&quot;, &quot;stars&quot; : 72 }
{ &quot;_id&quot; : null, &quot;stars&quot; : 52 }
{ &quot;_id&quot; : &quot;Python&quot;, &quot;stars&quot; : 47 }
{ &quot;_id&quot; : &quot;Shell&quot;, &quot;stars&quot; : 43 }
{ &quot;_id&quot; : &quot;HTML&quot;, &quot;stars&quot; : 19 }
</code></pre>
<h3>select name, substr(created_at, 0, 4) as created_at_year from repos order by created_at_year desc</h3>
<pre><code class="language-bash">&gt; db.repos.aggregate([{$addFields:{&quot;created_at_year&quot;:{$substr:[&quot;$created_at&quot;, 0, 4]}}}, {$project: {_id:0, name:1, created_at_year:1}}, {$sort: {created_at_year:-1}}])

{ &quot;name&quot; : &quot;aws-cli-cheatsheet&quot;, &quot;created_at_year&quot; : &quot;2020&quot; }
{ &quot;name&quot; : &quot;gitfolio&quot;, &quot;created_at_year&quot; : &quot;2020&quot; }
{ &quot;name&quot; : &quot;messenger-bot&quot;, &quot;created_at_year&quot; : &quot;2020&quot; }
{ &quot;name&quot; : &quot;urctl&quot;, &quot;created_at_year&quot; : &quot;2020&quot; }
{ &quot;name&quot; : &quot;annoying-bn-text&quot;, &quot;created_at_year&quot; : &quot;2019&quot; }
{ &quot;name&quot; : &quot;esp32-mqtt-ir-remote&quot;, &quot;created_at_year&quot; : &quot;2019&quot; }
</code></pre>
<h3>select substr(created_at, 0, 4)) as year, count(*) as count from repos group by year order by count desc</h3>
<pre><code class="language-bash">&gt; db.repos.aggregate([{$addFields:{&quot;created_at_year&quot;:{$substr:[&quot;$created_at&quot;, 0, 4]}}}, { $group: { _id: &quot;$created_at_year&quot;, count: { $sum: 1 } } },{ $sort: { count: -1 } }])

{ &quot;_id&quot; : &quot;2015&quot;, &quot;count&quot; : 41 }
{ &quot;_id&quot; : &quot;2016&quot;, &quot;count&quot; : 35 }
{ &quot;_id&quot; : &quot;2012&quot;, &quot;count&quot; : 18 }
{ &quot;_id&quot; : &quot;2014&quot;, &quot;count&quot; : 14 }
{ &quot;_id&quot; : &quot;2013&quot;, &quot;count&quot; : 12 }
{ &quot;_id&quot; : &quot;2019&quot;, &quot;count&quot; : 10 }
</code></pre>
<h3>select name, unix_timestamp(str_to_date(created_at, '%Y-%M-%dT%h:%m:%sz')) from repos</h3>
<pre><code class="language-bash">&gt; db.repos.aggregate([{$addFields: {date: { $dateFromString: { dateString: &quot;$created_at&quot; }}}}, {$project: {_id:0, created_at_usec: { $subtract: [ &quot;$date&quot;, new Date(&quot;1970-01-01&quot;) ] }, name:1}}])

{ &quot;name&quot; : &quot;a-pdf-reader&quot;, &quot;created_at_usec&quot; : NumberLong(&quot;1349642688000&quot;) }
{ &quot;name&quot; : &quot;apt-sync&quot;, &quot;created_at_usec&quot; : NumberLong(&quot;1511067443000&quot;) }
{ &quot;name&quot; : &quot;aws-cli-cheatsheet&quot;, &quot;created_at_usec&quot; : NumberLong(&quot;1582821501000&quot;) }
{ &quot;name&quot; : &quot;banglalion-wimax-mac&quot;, &quot;created_at_usec&quot; : NumberLong(&quot;1424891748000&quot;) }
{ &quot;name&quot; : &quot;annoying-bn-text&quot;, &quot;created_at_usec&quot; : NumberLong(&quot;1559755505000&quot;) }
</code></pre>
<h2>DELETE</h2>
<h3>delete from repose where language = "C++"</h3>
<pre><code class="language-bash">&gt; db.repos.remove({language:&quot;C++&quot;})
</code></pre>
<h2>ALTER</h2>
<h3>alter table repos drop column created_at</h3>
<pre><code class="language-bash">&gt; db.repos.update({},{$unset:{created_at:&quot;&quot;}})
</code></pre>
<h3>alter table repos insert column foo int</h3>
<pre><code class="language-bash">&gt; db.repos.update({}, {$set: {foo:0}}, {multi:1})
</code></pre>
<p>That's all for today. Feel free to share if any of the queries can be improved. Thanks for reading.</p>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-9642838276352812"
     data-ad-slot="8294162148"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        <script>hljs.highlightAll();</script>
    </section>
</article>
<!-- Comments section-->
<section class="mb-5">
    <div class="card bg-light">
        <div class="card-body">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;	
            dsq.src = 'https://bitsfromminhaz.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);	
            })();
            </script>
        </div>
    </div>
</section>

                </div>
                <div class="col-lg-3">
                    <div class="card mb-4">
                        <div class="card-header">Categories</div>
                        <ul class="list-group list-group-flush">
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/linux.html">
                                linux
                                <span class="badge text-bg-dark">30</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/snippets.html">
                                snippets
                                <span class="badge text-bg-dark">29</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/malaysia.html">
                                malaysia
                                <span class="badge text-bg-dark">9</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/macos.html">
                                macos
                                <span class="badge text-bg-dark">7</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/android.html">
                                android
                                <span class="badge text-bg-dark">7</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/qt.html">
                                qt
                                <span class="badge text-bg-dark">5</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/hardware.html">
                                hardware
                                <span class="badge text-bg-dark">5</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/openwrt.html">
                                openwrt
                                <span class="badge text-bg-dark">4</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/database.html">
                                database
                                <span class="badge text-bg-dark">1</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/aws.html">
                                aws
                                <span class="badge text-bg-dark">1</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/kubernetes.html">
                                kubernetes
                                <span class="badge text-bg-dark">1</span>
                            </a>
                        
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="py-5 bg-dark">
            <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Md. Minhazul Haque 2012-2022</p></div>
        </footer>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
