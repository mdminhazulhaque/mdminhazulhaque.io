<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="OpenWRT inside VirtualBox with Internet Connectivity from Host Machine" />
        <meta name="author" content="Md. Minhazul Haque">
        <title>
        OpenWRT inside VirtualBox with Internet Connectivity from Host Machine | 
        
        Minhaz Blog
        </title>
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Bengali&family=Ubuntu&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/styles/default.min.css">
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9642838276352812" crossorigin="anonymous"></script>
        <style>
        body {
            font-family: 'Ubuntu', 'Noto Serif Bengali', serif !important;
        }
        </style>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="/blog">
                    Minhaz
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        
                        <li class="nav-item"><a class="nav-link" href="/blog">Blog</a>
                        </li>
                        
                        <li class="nav-item"><a class="nav-link" href="https://github.com/mdminhazulhaque">Github</a>
                        </li>
                        
                        <li class="nav-item"><a class="nav-link" href="https://www.linkedin.com/in/mdminhazulhaque/">LinkedIn</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </nav>
        <div class="container mt-4">
            <div class="row">
                <div class="col-lg-9">
                    

<article>
    <header class="mb-4">
        <h1 class="fw-bolder mb-1">OpenWRT inside VirtualBox with Internet Connectivity from Host Machine</h1>
        <div class="text-muted fst-italic mb-2">Posted on 26 Nov, 2016 in openwrt</div>
    </header>
    <section class="mb-5">

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-9642838276352812"
     data-ad-slot="8038474176"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<br>

        <p>Last week I tried to run OpenWRT inside a VM and had a lot of troubles before being successful. So I thought that I should write a post about it.</p>
<p>First, you will need a virtualization software, VirtualBox seems to be a perfect fit for such purpose. Then you will need a ext4 disk image of OpenWRT with x86-64 support because VirtualBox supports no other architectures other than x86/x64. The latest image can be downloaded from this link.</p>
<pre><code>https://downloads.openwrt.org/snapshots/trunk/x86/64/openwrt-x86-64-combined-ext4.img.gz
</code></pre>
<p>After downloading the compressed gzipped image, let's convert it into raw disk image and then into VirtualBox compatible VDI image.</p>
<pre><code class="language-bash">gunzip openwrt-x86-64-combined-ext4.img.gz
VBoxManage convertfromraw --format VDI openwrt-x86-64-combined-ext4.img openwrt-x86-64-combined-ext4.vdi
</code></pre>
<p>Now let's create an OpenWRT VM with the previously converted VDI image. The following script does the trick in 1s.</p>
<pre><code class="language-bash">VMNAME=&quot;openwrt&quot;
VDI=&quot;/home/minhaz/openwrt-x86-64-combined-ext4.vdi&quot; # change here

VBoxManage createvm --name $VMNAME --register &amp;&amp; \
VBoxManage modifyvm $VMNAME \
    --description &quot;An OpenWRT VM&quot; \
    --ostype &quot;Linux_64&quot; \
    --memory &quot;256&quot; \
    --cpus &quot;1&quot; \
    --nic1 &quot;intnet&quot; \
    --nictype1 &quot;82540EM&quot; \
    --nic2 &quot;nat&quot; \
    --nictype2 &quot;82540EM&quot; \
    --natpf2 &quot;ssh,tcp,,2222,,22&quot; \
    --natpf2 &quot;luci,tcp,,8080,,80&quot; \
    --natpf2 &quot;ftp,tcp,,2121,,21&quot; &amp;&amp; \
VBoxManage storagectl $VMNAME \
    --name &quot;SATA Controller&quot; \
    --add &quot;sata&quot; \
    --portcount &quot;1&quot; \
    --hostiocache &quot;on&quot; \
    --bootable &quot;on&quot; &amp;&amp; \
VBoxManage storageattach $VMNAME \
    --storagectl &quot;SATA Controller&quot; \
    --port &quot;1&quot; \
    --type &quot;hdd&quot; \
    --nonrotational &quot;on&quot; \
    --medium $VDI
</code></pre>
<p>Note that, I have set the NIC type to 82540EM which works automatically with OpenWRT modules. So whenever you boot OpenWRT, it will automatically detect NIC2 as WAN. This will allow you to ping google.com, update opkg and install packages too.</p>
<p>As you can see, I have forwarded port 21, 22 and 80 to the host machine. You might need to disable or modify the firewall configuration of the OpenWRT instance.</p>
<p>You can access LUCI of the instance by browsing to <code>http://localhost:8080</code> and SSH into it by <code>ssh root@localhost -p 2222</code>.</p>
<p>I hope that helps.</p>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-9642838276352812"
     data-ad-slot="8294162148"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        <script>hljs.highlightAll();</script>
    </section>
</article>
<!-- Comments section-->
<section class="mb-5">
    <div class="card bg-light">
        <div class="card-body">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;	
            dsq.src = 'https://bitsfromminhaz.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);	
            })();
            </script>
        </div>
    </div>
</section>

                </div>
                <div class="col-lg-3">
                    <div class="card mb-4">
                        <div class="card-header">Categories</div>
                        <ul class="list-group list-group-flush">
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/linux.html">
                                linux
                                <span class="badge text-bg-dark">30</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/snippets.html">
                                snippets
                                <span class="badge text-bg-dark">29</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/malaysia.html">
                                malaysia
                                <span class="badge text-bg-dark">9</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/macos.html">
                                macos
                                <span class="badge text-bg-dark">7</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/android.html">
                                android
                                <span class="badge text-bg-dark">7</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/qt.html">
                                qt
                                <span class="badge text-bg-dark">5</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/hardware.html">
                                hardware
                                <span class="badge text-bg-dark">5</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/openwrt.html">
                                openwrt
                                <span class="badge text-bg-dark">4</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/database.html">
                                database
                                <span class="badge text-bg-dark">1</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/aws.html">
                                aws
                                <span class="badge text-bg-dark">1</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/kubernetes.html">
                                kubernetes
                                <span class="badge text-bg-dark">1</span>
                            </a>
                        
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="py-5 bg-dark">
            <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Md. Minhazul Haque 2012-2022</p></div>
        </footer>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
