<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="Turn TL-MR3420 into WiFi Repeater using OpenWRT" />
        <meta name="author" content="Md. Minhazul Haque">
        <title>
        Turn TL-MR3420 into WiFi Repeater using OpenWRT | 
        
        Minhaz Blog
        </title>
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Bengali&family=Ubuntu&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/styles/default.min.css">
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9642838276352812" crossorigin="anonymous"></script>
        <style>
        body {
            font-family: 'Ubuntu', 'Noto Serif Bengali', serif !important;
        }
        </style>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="/blog">
                    Minhaz
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        
                        <li class="nav-item"><a class="nav-link" href="/blog">Blog</a>
                        </li>
                        
                        <li class="nav-item"><a class="nav-link" href="https://github.com/mdminhazulhaque">Github</a>
                        </li>
                        
                        <li class="nav-item"><a class="nav-link" href="https://www.linkedin.com/in/mdminhazulhaque/">LinkedIn</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </nav>
        <div class="container mt-4">
            <div class="row">
                <div class="col-lg-9">
                    

<article>
    <header class="mb-4">
        <h1 class="fw-bolder mb-1">Turn TL-MR3420 into WiFi Repeater using OpenWRT</h1>
        <div class="text-muted fst-italic mb-2">Posted on 28 Sep, 2016 in openwrt</div>
    </header>
    <section class="mb-5">

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-9642838276352812"
     data-ad-slot="8038474176"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<br>

        <div class="message">
Download TL-MR3420 OpenWRT Firmware with relayd preinstalled from <a href="https://github.com/mdminhazulhaque/OpenWRT-TL-MR3420/tree/master/repeater">mdminhazulhaque/OpenWRT-TL-MR3420</a>
</div>

<p>I have been using my <a href="http://www.tp-link.com.bd/products/details/cat-14_TL-MR3420.html">TL-MR3420</a> (Version 2.2) router as a repeater for a month. The access point in my house is an Apple Airport which delivers pretty good signal even when there exists several obstacles (walls, doors) between the Airport and my WLAN card. But I badly needed a repeater for syncing files from/to my wireless devices. So I turned my old router into a WiFi repeater.</p>
<p>First, let's disable the firewall and DNS masquerading because we will be using a Bridged Repeater which will act exactly like the Airport I have been using as access point. First, install <code>relayd</code> which will get most of the job done for us.</p>
<pre><code class="language-bash">/etc/init.d/firewall stop
/etc/init.d/firewall disable
/etc/init.d/dnsmasq stop
/etc/init.d/dnsmasq disable
opkg update # in case the feeds are outdated
opkg install relayd
</code></pre>
<p>Now configure <code>/etc/config/wireless</code> as the following.</p>
<pre><code class="language-bash"># nano /etc/config/wireless
config wifi-device 'radio0'
    option type 'mac80211'
    option channel '11' # Same as source
    option hwmode '802.11n' # Use bgn if needed
    option path 'platform/ar934x_wmac'
    option htmode 'HT40-' # 300MB/s
    option txpower '30'
    option country 'BD'
    option noscan '1'

config wifi-iface
    option device 'radio0'
    option network 'wwan'
    option encryption 'psk2'
    option key '12345678'
    option mode 'sta'
    option ssid 'source_ssid'

config wifi-iface
    option device 'radio0'
    option network 'lan'
    option encryption 'psk2'
    option key '87654321'
    option mode 'ap'
    option ssid 'repeater_ssid'
</code></pre>
<p>Now let's change <code>/etc/config/network</code> also. You have to be very careful in this step. Otherwise the repeater may not work, or even if it works, you may not get internet connectivity through it.</p>
<pre><code class="language-bash"># nano /etc/config/network
config interface 'loopback'
    option ifname 'lo'
    option proto 'static'
    option ipaddr '127.0.0.1'
    option netmask '255.0.0.0'

config interface 'lan'
    option ifname 'eth0'
    option force_link '1'
    option type 'bridge'
    option proto 'static'
    option ip6assign '60'
    option ipaddr '192.168.10.1' # for relayd
    option gateway '10.0.1.1' # gateway of source
    option netmask '255.255.255.0'
    option dns '10.0.1.1' # dns of source

config interface 'wwan'
    option proto 'static'
    option ipaddr '10.0.1.254' # any ip from source
    option netmask '255.255.255.0'
    option gateway '10.0.1.1'

config interface 'stabridge'
    option proto 'relay'
    option network 'lan wwan'
    option ipaddr '10.0.1.254'

config switch
    option name 'switch0'
    option reset '1'
    option enable_vlan '1'

config switch_vlan
    option device 'switch0'
    option vlan '1'
    option ports '0 1 2 3 4'
</code></pre>
<p>Note that I have used <code>10.0.1.254</code> which will be the repeater's IP address. This is very important to set this IP correctly. Do not set IP address like <code>10.0.1.1</code> which is the gateway of the access point (!) or any other IP which is already reserved in the Airport (or any source WiFi access point). You can later <code>ssh</code> or <code>telnet</code> using the IP address of the <code>stabridge</code> device.</p>
<p>Now, edit <code>/etc/config/dhcp</code> according to the following.</p>
<pre><code class="language-bash"># nano /etc/config/dhcp
config dhcp 'lan'
    option interface 'lan'
    option start '100'
    option limit '150'
    option leasetime '12h'
    option ignore '1'

config dhcp 'wan'
    option interface 'wan'
    option ignore '1'
</code></pre>
<p>Now we are almost done. Now just enable <code>relayd</code> and reboot the router.</p>
<pre><code class="language-bash">/etc/init.d/relayd enable
reboot
</code></pre>
<p>After 15-30s of boot, you can see the new repeater SSID in the WiFi menu of your phone/computer. Connect to it and check if the internet works.</p>
<p>If you fail, review the config files and keep trying. I suggest you to closely observe the config file because if you miss one single character, the WiFi may not start, or the internet connectivity might fall.</p>
<p>Good luck!</p>
<div class="message">
Thanks to <a href="http://www.circuidipity.com/openwrt-bridged-repeater.html">Daniel Wayne Armstrong's post</a> for writing a nice post which really works and saved me from headache.
</div>

<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-9642838276352812"
     data-ad-slot="8294162148"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        <script>hljs.highlightAll();</script>
    </section>
</article>
<!-- Comments section-->
<section class="mb-5">
    <div class="card bg-light">
        <div class="card-body">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;	
            dsq.src = 'https://bitsfromminhaz.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);	
            })();
            </script>
        </div>
    </div>
</section>

                </div>
                <div class="col-lg-3">
                    <div class="card mb-4">
                        <div class="card-header">Categories</div>
                        <ul class="list-group list-group-flush">
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/linux.html">
                                linux
                                <span class="badge text-bg-dark">30</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/snippets.html">
                                snippets
                                <span class="badge text-bg-dark">29</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/malaysia.html">
                                malaysia
                                <span class="badge text-bg-dark">9</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/macos.html">
                                macos
                                <span class="badge text-bg-dark">7</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/android.html">
                                android
                                <span class="badge text-bg-dark">7</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/qt.html">
                                qt
                                <span class="badge text-bg-dark">5</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/hardware.html">
                                hardware
                                <span class="badge text-bg-dark">5</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/openwrt.html">
                                openwrt
                                <span class="badge text-bg-dark">4</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/database.html">
                                database
                                <span class="badge text-bg-dark">1</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/aws.html">
                                aws
                                <span class="badge text-bg-dark">1</span>
                            </a>
                        
                            <a class="list-group-item d-flex justify-content-between align-items-start" href="/blog/kubernetes.html">
                                kubernetes
                                <span class="badge text-bg-dark">1</span>
                            </a>
                        
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="py-5 bg-dark">
            <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Md. Minhazul Haque 2012-2022</p></div>
        </footer>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
